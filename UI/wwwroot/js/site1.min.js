$(function(){function c(n){d3.select("svg").attr("width",i).attr("height",r).selectAll("path").data(n.features).enter().append("path").attr("class","countries").attr("d",u);d3.selectAll("path.countries").on("mouseover",l).on("mouseout",a)}function l(n){var i=[];meteorites.forEach(t=>{t.Country===n.properties.name&&i.push(t.Country)});t.transition().duration(200).style("opacity",.9);t.html(n.properties.name+" has "+i.length+" meteorites").style("left",d3.event.pageX+28+"px").style("top",d3.event.pageY+28+"px")}function a(){t.transition().duration(500).style("opacity",0)}function o(t){d3.select("svg").selectAll("circle").data(t).enter().append("circle").attr("class","meteorites").attr("r",1.5).attr("cx",t=>n([parseFloat(t.Longitude),parseFloat(t.Latitude)])[0]).attr("cy",t=>n([parseFloat(t.Longitude),parseFloat(t.Latitude)])[1]);d3.selectAll("circle.meteorites").on("mouseover",v).on("mouseout",y).on("click",p)}function v(n){t.transition().duration(200).style("opacity",.9);t.html("Meteorite Name: "+n.Name).style("left",d3.event.pageX+28+"px").style("top",d3.event.pageY+28+"px")}function y(){t.transition().duration(500).style("opacity",0)}function p(n){$(".modal-content").html("");var t=$("#myModal"),i=$(".close");$.map(n,(n,t)=>{var i=$("<p>");i.text(`${t}: ${n}`);i.appendTo($(".modal > .modal-content"))});t.css({display:"block"});i.on("click",()=>{t.css({display:"none"})});$(window).on("click",n=>{n.target.id==="myModal"&&t.css({display:"none"})})}function b(){var t=d3.event,o=document.querySelector("path.graticule.line"),s=o.getBoundingClientRect().height/2,h=s,c=r-s,l=o.getBoundingClientRect().width/2,a=i/2-l,v=i/2+l,f,e;o.getBoundingClientRect().height<r?(f=t.transform.y,t.transform.y<h?f=h:t.transform.y>c&&(f=c),e=t.transform.x,t.transform.x<a?e=a:t.transform.x>v&&(e=v),n.translate([e,f]).scale(t.transform.k)):n.translate([t.transform.x,t.transform.y]).scale(t.transform.k);d3.selectAll("path.graticule").attr("d",u);d3.selectAll("path.countries").attr("d",u);d3.selectAll("circle.meteorites").attr("cx",t=>n([t.Longitude,t.Latitude])[0]).attr("cy",t=>n([t.Longitude,t.Latitude])[1])}var f=(n,t)=>new Promise(i=>n(t,n=>i(n))),h=1,e=0;Promise.all([f(d3.json,"StaticFiles/world.geojson"),f(d3.json,"api/meteorites?pageNumber=1&pageSize=100")]).then(n=>{c(n[0]);o(n[1]);var t=window.setInterval(()=>{if(e>=1e3){clearInterval(t);return}$.getJSON(`api/meteorites?pageNumber=${h++}&pageSize=100`).done(n=>{e+=_.size(n),o(n)})},1e3)});var i=window.innerWidth,r=window.innerHeight,t=d3.select("body").append("div").attr("class","tooltip").style("opacity",0),n=d3.geoMollweide().scale(300).translate([i/2,r/2]),u=d3.geoPath().projection(n);(function(){var n=d3.geoGraticule();d3.select("svg").insert("path","path.countries").datum(n).attr("class","graticule line").attr("d",u);d3.select("svg").insert("path","path.countries").datum(n.outline).attr("class","graticule outline").attr("d",u)})();var s=d3.zoom().scaleExtent([150,2e3]).on("zoom",b),w=d3.zoomIdentity.translate(i/2,r/2).scale(300),k=d3.scaleLinear().domain([-500,0,500]).range([-180,0,180]);d3.select("svg").call(s).call(s.transform,w)});