$(function(){function u(n,r){function c(n){var t=[];r.forEach(i=>{i.Country===n.properties.name&&t.push(i.Country)});e.transition().duration(200).style("opacity",.9);e.html(n.properties.name+" has "+t.length+" meteorites").style("left",d3.event.pageX+"px").style("top",d3.event.pageY+"px")}function l(){e.transition().duration(500).style("opacity",0)}function a(){var n=d3.event,o=document.querySelector("path.graticule.line"),s=o.getBoundingClientRect().width/2,h=o.getBoundingClientRect().height/2,c=h,l=i-h,r=n.transform.y;n.transform.y<c?r=c:n.transform.y>l&&(r=l);var a=t/2-s,v=t/2+s,e=n.transform.x;n.transform.x<a?e=a:n.transform.x>v&&(e=v);f.translate([e,r]).scale(n.transform.k);d3.selectAll("path.graticule").attr("d",u);d3.selectAll("path.countries").attr("d",u);d3.selectAll("circle.meteorites").attr("cx",n=>f([n.Longitude,n.Latitude])[0]).attr("cy",n=>f([n.Longitude,n.Latitude])[1])}var f=d3.geoMollweide(),u=d3.geoPath().projection(f),e,o,s,h;d3.select("svg").attr("width",t).attr("height",i).selectAll("path").data(n.features).enter().append("path").attr("class","countries").attr("d",u);d3.select("svg").selectAll("circle").data(r).enter().append("circle").attr("class","meteorites").attr("r",3);d3.selectAll("path.countries").on("mouseover",c).on("mouseout",l);e=d3.select("body").append("div").attr("class","tooltip").style("opacity",0);o=d3.geoGraticule();d3.select("svg").insert("path","path.countries").datum(o).attr("class","graticule line").attr("d",u);d3.select("svg").insert("path","path.countries").datum(o.outline).attr("class","graticule outline").attr("d",u);s=d3.zoom().scaleExtent([150,800]).on("zoom",a);h=d3.zoomIdentity.translate(t/2,i/2).scale(150);d3.select("svg").call(s).call(s.transform,h)}var r=(n,t)=>new Promise(i=>n(t,n=>i(n)));Promise.all([r(d3.json,"StaticFiles/world.geojson"),r(d3.json,"api/meteorites")]).then(n=>{u(n[0],n[1])});var n={top:20,right:20,bottom:20,left:20},t=window.innerWidth-n.left-n.right,i=window.innerHeight-n.top-n.bottom});