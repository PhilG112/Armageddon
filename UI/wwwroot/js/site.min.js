$(function(){function e(i,u){function c(n){f.transition().duration(200).style("opacity",.9);f.html("Meteorite Name: "+n.Name).style("left",d3.event.pageX+28+"px").style("top",d3.event.pageY+28+"px")}function l(){f.transition().duration(500).style("opacity",0)}function a(n){$(".modal-content").html("");var t=$("#myModal"),i=$(".close");$.map(n,(n,t)=>{var i=$("<p>");i.text(`${t}: ${n}`);i.appendTo($(".modal > .modal-content"))});t.css({display:"block"});i.on("click",()=>{t.css({display:"none"})});$(window).on("click",n=>{n.target.id==="myModal"&&t.css({display:"none"})})}function v(n){var t=[];u.forEach(i=>{i.Country===n.properties.name&&t.push(i.Country)});f.transition().duration(200).style("opacity",.9);f.html(n.properties.name+" has "+t.length+" meteorites").style("left",d3.event.pageX+28+"px").style("top",d3.event.pageY+28+"px")}function y(){f.transition().duration(500).style("opacity",0)}function w(){var i=d3.event,f=document.querySelector("path.graticule.line"),s=f.getBoundingClientRect().height/2,h=s,c=t-s,l=f.getBoundingClientRect().width/2,a=n/2-l,v=n/2+l,r,u;f.getBoundingClientRect().height<t?(r=i.transform.y,i.transform.y<h?r=h:i.transform.y>c&&(r=c),u=i.transform.x,i.transform.x<a?u=a:i.transform.x>v&&(u=v),e.translate([u,r]).scale(i.transform.k)):e.translate([i.transform.x,i.transform.y]).scale(i.transform.k);d3.selectAll("path.graticule").attr("d",o);d3.selectAll("path.countries").attr("d",o);d3.selectAll("circle.meteorites").attr("cx",n=>e([n.Longitude,n.Latitude])[0]).attr("cy",n=>e([n.Longitude,n.Latitude])[1])}var e=d3.geoMollweide(),o=d3.geoPath().projection(e),f,s;r.attr("width",n).attr("height",t).selectAll("path").data(i.features).enter().append("path").attr("class","countries").attr("d",o);r.selectAll("circle").data(u).enter().append("circle").attr("class","meteorites").attr("r",1.3);f=d3.select("body").append("div").attr("class","tooltip").style("opacity",0);d3.selectAll("circle.meteorites").on("mouseover",c).on("mouseout",l).on("click",a);d3.selectAll("path.countries").on("mouseover",v).on("mouseout",y);s=d3.geoGraticule();d3.select("svg").insert("path","path.countries").datum(s).attr("class","graticule line").attr("d",o);d3.select("svg").insert("path","path.countries").datum(s.outline).attr("class","graticule outline").attr("d",o);var h=d3.zoom().scaleExtent([150,2e3]).on("zoom",w),p=d3.zoomIdentity.translate(n/2,t/2).scale(300),b=d3.scaleLinear().domain([-500,0,500]).range([-180,0,180]);d3.select("svg").call(h).call(h.transform,p)}function o(){r.attr("width",window.innerWidth).attr("height",window.innerHeight)}var u=(n,t)=>new Promise(i=>n(t,n=>i(n))),f=1,i=0;Promise.all([u(d3.json,"StaticFiles/world.geojson"),u(d3.json,"api/meteorites?pageNumber=1&pageSize=100")]).then(n=>{e(n[0],n[1]),i+=n[1].length});var n=window.innerWidth,t=window.innerHeight;const r=d3.select("svg");$(window).on("resize",o);$("button").on("click",()=>{var t=$("input").val(),n;$.getJSON(`api/meteorites?pageNumber=${f++}&pageSize=${t}`).done(n=>{console.log(n);i+=n.length;for(let n in n)setTimeout(()=>{console.log(n)},n*100)});n=$(".controls > p");n.text(i)})});