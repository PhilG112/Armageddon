$(function(){function u(t,u){function l(n){var t=[];u.forEach(i=>{i.Country===n.properties.name&&t.push(i.Country)});o.transition().duration(200).style("opacity",.9);o.html(n.properties.name+" has "+t.length+" meteorites").style("left",d3.event.pageX+"px").style("top",d3.event.pageY+"px")}function a(){o.transition().duration(500).style("opacity",0)}function v(){var n=d3.event;e.translate([n.transform.x,n.transform.y]).scale(n.transform.k);d3.selectAll("path.graticule").attr("d",f);d3.selectAll("path.countries").attr("d",f);d3.selectAll("circle.meteorites").attr("cx",n=>e([n.Longitude,n.Latitude])[0]).attr("cy",n=>e([n.Longitude,n.Latitude])[1])}var e=d3.geoMollweide(),f=d3.geoPath().projection(e),o,s,h,c;d3.select("svg").attr("width",i+n.left+n.right).attr("height",r+n.top+n.bottom).selectAll("path").data(t.features).enter().append("path").attr("class","countries").attr("d",f);d3.select("svg").selectAll("circle").data(u).enter().append("circle").attr("class","meteorites").attr("r",3).attr("cx",n=>e([parseFloat(n.Longitude),parseFloat(n.Latitude)])[0]).attr("cy",n=>e([parseFloat(n.Longitude),parseFloat(n.Latitude)])[1]);d3.selectAll("path.countries").on("mouseover",l).on("mouseout",a);o=d3.select("body").append("div").attr("class","tooltip").style("opacity",0);s=d3.geoGraticule();d3.select("svg").insert("path","path.countries").datum(s).attr("class","graticule line").attr("d",f);d3.select("svg").insert("path","path.countries").datum(s.outline).attr("class","graticule outline").attr("d",f);h=d3.zoom().on("zoom",v);c=d3.zoomIdentity.translate(i/2,r/2).scale(300);d3.select("svg").call(h).call(h.transform,c)}var t=(n,t)=>new Promise(i=>n(t,n=>i(n)));Promise.all([t(d3.json,"StaticFiles/world.geojson"),t(d3.json,"api/meteorites")]).then(n=>{u(n[0],n[1])});var n={top:20,right:20,bottom:30,left:50},i=window.innerWidth-n.left-n.right,r=window.innerHeight-n.top-n.bottom});