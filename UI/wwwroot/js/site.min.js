$(function(){function u(n,r){function h(n){f.transition().duration(200).style("opacity",.9);f.html("Meteorite Name: "+n.Name).style("left",d3.event.pageX+"px").style("top",d3.event.pageY+"px")}function c(){f.transition().duration(500).style("opacity",0)}function l(n){$(".modal-content").html("");var t=$("#myModal"),i=$(".close");$.map(n,(n,t)=>{var i=$("<p>");i.text(`${t}: ${n}`);i.appendTo($(".modal > .modal-content"))});t.css({display:"block"});i.on("click",()=>{t.css({display:"none"})});$(window).on("click",n=>{n.target.id==="myModal"&&t.css({display:"none"})})}function a(n){var t=[];r.forEach(i=>{i.Country===n.properties.name&&t.push(i.Country)});f.transition().duration(200).style("opacity",.9);f.html(n.properties.name+" has "+t.length+" meteorites").style("left",d3.event.pageX+"px").style("top",d3.event.pageY+"px")}function v(){f.transition().duration(500).style("opacity",0)}function w(){var t=d3.event,n=p(t.transform.x)%360;e.rotate([n,0]).scale(t.transform.k);d3.selectAll("path.graticule").attr("d",u);d3.selectAll("path.countries").attr("d",u);d3.selectAll("circle.meteorites").each(function(t){var r=e([t.Longitude,t.Latitude]),i=parseFloat(t.Longitude),u=i+n<90&&i+n>90||i+n<-270&&i+n>-600||i+n>270&&i+n<600?"block":"none";d3.select(this).attr("cx",parseFloat(r[0])).attr("cy",parseFloat(r[1])).style("display",u)})}var e=d3.geoOrthographic().center([0,0]).translate([t/2,i/2]),u=d3.geoPath().projection(e),f,o;d3.select("svg").attr("width",t).attr("height",i).selectAll("path").data(n.features).enter().append("path").attr("class","countries").attr("d",u);d3.select("svg").selectAll("circle").data(r).enter().append("circle").attr("class","meteorites").attr("r",1.5);f=d3.select("body").append("div").attr("class","tooltip").style("opacity",0);d3.selectAll("circle.meteorites").on("mouseover",h).on("mouseout",c).on("click",l);d3.selectAll("path.countries").on("mouseover",a).on("mouseout",v);o=d3.geoGraticule();d3.select("svg").insert("path","path.countries").datum(o).attr("class","graticule line").attr("d",u);d3.select("svg").insert("path","path.countries").datum(o.outline).attr("class","graticule outline").attr("d",u);var s=d3.zoom().scaleExtent([150,600]).on("zoom",w),y=d3.zoomIdentity.translate(t/2,i/2).scale(300),p=d3.scaleLinear().domain([-500,0,500]).range([-180,0,180]);d3.select("svg").call(s).call(s.transform,y)}var r=(n,t)=>new Promise(i=>n(t,n=>i(n)));Promise.all([r(d3.json,"StaticFiles/world.geojson"),r(d3.json,"api/meteorites?page=1")]).then(n=>{u(n[0],n[1])});var n={top:20,right:20,bottom:20,left:20},t=window.innerWidth-n.left-n.right,i=window.innerHeight-n.top-n.bottom});