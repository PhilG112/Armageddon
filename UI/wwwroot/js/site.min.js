$(function(){function a(t){var i=(n,t)=>new Promise(i=>n(t,n=>i(n)));Promise.all([i(d3.json,"StaticFiles/world.geojson")]).then(i=>{t==="orthographic"?(v(i[0],r),c(t)):(v(i[0],n),c(t))})}function v(n,i){$("svg > *").remove();t=d3.geoPath().projection(i);s.selectAll("path").data(n.features).enter().insert("path").attr("class","countries").attr("d",t);d3.selectAll("path.countries").on("mouseover",g).on("mouseout",nt);var r=d3.geoGraticule();d3.select("svg").insert("path","path.countries").datum(r).attr("class","graticule line").attr("d",t);d3.select("svg").insert("path","path.countries").datum(r.outline).attr("class","graticule outline").attr("d",t);c();rt()}function c(n){var t=d3.zoom().scaleExtent([150,800]).on("zoom",n==="orthographic"?k:d),i=d3.zoomIdentity.translate(f/2,e/2).scale(300);d3.select("svg").call(t).call(t.transform,i)}function k(){var i=d3.event,u=d3.scaleLinear().domain([-500,0,500]).range([-180,0,180]),n=u(i.transform.x)%360;r.rotate([n,i.transform.y]).scale(i.transform.k);d3.selectAll("path.graticule").attr("d",t);d3.selectAll("path.countries").attr("d",t);d3.selectAll("circle.meteorites").each(function(t){var u=r([t.Longitude,t.Latitude]),i=parseFloat(t.Longitude),f=i+n<90&&i+n>90||i+n<-270&&i+n>-450||i+n>270&&i+n<450?"block":"none";d3.select(this).attr("cx",parseFloat(u[0])).attr("cy",parseFloat(u[1])).style("display",f)})}function d(){var i=d3.event,r=document.querySelector("path.graticule.line"),u=r.getBoundingClientRect().height/2,o=u,s=e-u,h=r.getBoundingClientRect().width/2,c=f/2-h,l=f/2+h;if(r.getBoundingClientRect().height<e){let t=i.transform.y;i.transform.y<o?t=o:i.transform.y>s&&(t=s);let r=i.transform.x;i.transform.x<c?r=c:i.transform.x>l&&(r=l);n.translate([r,t]).scale(i.transform.k)}else n.translate([i.transform.x,i.transform.y]).scale(i.transform.k);d3.selectAll("path.graticule").attr("d",t);d3.selectAll("path.countries").attr("d",t);d3.selectAll("circle.meteorites").attr("cx",t=>n([t.Longitude,t.Latitude])[0]).attr("cy",t=>n([t.Longitude,t.Latitude])[1])}function g(n){var t=[];i.forEach(i=>{i.Country===n.properties.name&&t.push(i.Country)});u.transition().duration(200).style("opacity",.9);u.html(n.properties.name+" has "+t.length+" meteorites").style("left",d3.event.pageX+28+"px").style("top",d3.event.pageY+28+"px")}function nt(){u.transition().duration(500).style("opacity",0)}function y(n){u.transition().duration(200).style("opacity",.9);u.html("Meteorite Name: "+n.Name).style("left",d3.event.pageX+28+"px").style("top",d3.event.pageY+28+"px")}function p(){u.transition().duration(200).style("opacity",0)}function w(n){$(".modal-content").html("");var t=$("#myModal"),i=$(".close");$.map(n,(n,t)=>{var i=$("<p>");i.text(`${t}: ${n}`);i.appendTo($(".modal > .modal-content"))});t.css({display:"block"});i.on("click",()=>{t.css({display:"none"})});$(window).on("click",n=>{n.target.id==="myModal"&&t.css({display:"none"})})}function tt(){s.attr("width",window.innerWidth).attr("height",window.innerHeight)}function it(t,u){i.push(t);window.setTimeout(()=>{var i=s.data([t]).append("circle").attr("class","meteorites").attr("r",30).attr("cx",t=>o==="orthographic"?r([t.Longitude,t.Latitude])[0]:n([t.Longitude,t.Latitude])[0]).attr("cy",t=>o==="orthographic"?r([t.Longitude,t.Latitude])[1]:n([t.Longitude,t.Latitude])[1]).on("mouseover",y).on("mouseout",p).on("click",w);i.transition().duration(300).attr("r",2.5).ease()},u*100)}function rt(){if(i.length>0){console.log(i);for(let t=0;t<i.length;t++)s.data([i[t]]).insert("circle").attr("class","meteorites").attr("r",2.5).attr("cx",t=>o==="orthographic"?r([t.Longitude,t.Latitude])[0]:n([t.Longitude,t.Latitude])[0]).attr("cy",t=>o==="orthographic"?r([t.Longitude,t.Latitude])[1]:n([t.Longitude,t.Latitude])[1]).on("mouseover",y).on("mouseout",p).on("click",w)}else return}var f=window.innerWidth,e=window.innerHeight,s=d3.select("svg").attr("width",f).attr("height",e),t=null,r=d3.geoOrthographic().center([0,0]).scale(300).translate([f/2,e/2]),n=d3.geoMollweide().scale(300).translate([f/2,e/2]),o=null,u,i;$("#mollweide-map").on("click",()=>{a("mollweide"),o="mollweide"});$("#orthographic-map").on("click",()=>{a("orthographic"),o="orthographic"});u=d3.select("body").append("div").attr("class","tooltip").style("opacity",0);i=[];$(window).on("resize",tt);var h=0,l=!0,b=1;$("#load-meteorites").on("click",()=>{var n=$("input").val(),t=$("#amount-loaded");l?(l=!1,$.getJSON(`api/meteorites?pageNumber=${b++}&pageSize=${n||100}`).done(n=>{h+=n.length,n.forEach((n,t)=>{it(n,t)}),t.text(h),l=!0})):($("#request-notice").fadeIn(),$("#request-notice").fadeOut())});$("#reset-btn").on("click",()=>{$("svg > circle").remove(),h=0,i=[],$("#amount-loaded").text(h),b=1});$(window).on("load",()=>{$(".splash").fadeIn(4e3),$(".splash").fadeOut(2e3,()=>{$(".instructions").fadeIn(4e3)})});$("#start").on("click",()=>{$(".instructions").fadeOut(2e3,()=>{$(".controls").fadeIn(4e3),$(".reset-container").fadeIn(4e3)})})});