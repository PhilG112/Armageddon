$(function(){function h(n){var t=(n,t)=>new Promise(i=>n(t,n=>i(n)));Promise.all([t(d3.json,"StaticFiles/world.geojson")]).then(t=>{n.target===$("#orthographic-map")?c(t[0],u):c(t[0],f)})}function c(t,i){n=d3.geoPath().projection(i);e.selectAll("path").data(t.features).enter().append("path").attr("class","countries").attr("d",n);d3.selectAll("path.countries").on("mouseover",y).on("mouseout",p);var r=d3.geoGraticule();d3.select("svg").insert("path","path.countries").datum(r).attr("class","graticule line").attr("d",n);d3.select("svg").insert("path","path.countries").datum(r.outline).attr("class","graticule outline").attr("d",n);a()}function a(){var n=d3.zoom().scaleExtent([150,800]).on("zoom",v),r=d3.zoomIdentity.translate(t/2,i/2).scale(300);d3.select("svg").call(n).call(n.transform,r)}function v(){var r=d3.event,o=document.querySelector("path.graticule.line"),s=o.getBoundingClientRect().height/2,h=s,c=i-s,l=o.getBoundingClientRect().width/2,a=t/2-l,v=t/2+l,u,e;o.getBoundingClientRect().height<i?(u=r.transform.y,r.transform.y<h?u=h:r.transform.y>c&&(u=c),e=r.transform.x,r.transform.x<a?e=a:r.transform.x>v&&(e=v),f.translate([e,u]).scale(r.transform.k)):f.translate([r.transform.x,r.transform.y]).scale(r.transform.k);d3.selectAll("path.graticule").attr("d",n);d3.selectAll("path.countries").attr("d",n);d3.selectAll("circle.meteorites").attr("cx",n=>f([n.Longitude,n.Latitude])[0]).attr("cy",n=>f([n.Longitude,n.Latitude])[1])}function y(n){var t=[];o.forEach(i=>{i.Country===n.properties.name&&t.push(i.Country)});r.transition().duration(200).style("opacity",.9);r.html(n.properties.name+" has "+t.length+" meteorites").style("left",d3.event.pageX+28+"px").style("top",d3.event.pageY+28+"px")}function p(){r.transition().duration(500).style("opacity",0)}function w(n){r.transition().duration(200).style("opacity",.9);r.html("Meteorite Name: "+n.Name).style("left",d3.event.pageX+28+"px").style("top",d3.event.pageY+28+"px")}function b(){r.transition().duration(500).style("opacity",0)}function k(n){$(".modal-content").html("");var t=$("#myModal"),i=$(".close");$.map(n,(n,t)=>{var i=$("<p>");i.text(`${t}: ${n}`);i.appendTo($(".modal > .modal-content"))});t.css({display:"block"});i.on("click",()=>{t.css({display:"none"})});$(window).on("click",n=>{n.target.id==="myModal"&&t.css({display:"none"})})}function d(){e.attr("width",window.innerWidth).attr("height",window.innerHeight)}var t=window.innerWidth,i=window.innerHeight,r=d3.select("body").append("div").attr("class","tooltip").style("opacity",0),e=d3.select("svg").attr("width",t).attr("height",i),n=null,u=d3.geoOrthographic().center([0,0]).scale(300).translate([t/2,i/2]),f=d3.geoMollweide().scale(300).translate([t/2,i/2]),o;$("#mollweide-map").on("click",n=>{h(n)});$("#orthographic-map").on("click",n=>{h(n)});o=[];$(window).on("resize",d);var l=0,s=!0,g=1;$("#load-meteorites").on("click",()=>{var n=$("input").val(),t=$(".controls > p");s?(s=!1,$.getJSON(`api/meteorites?pageNumber=${g++}&pageSize=${n||100}`).done(n=>{l+=n.length,n.forEach((n,t)=>{o.push(n),window.setTimeout(()=>{e.data([n]).append("circle").attr("class","meteorites").attr("r",2.5).attr("cx",n=>u([n.Longitude,n.Latitude])[0]).attr("cy",n=>u([n.Longitude,n.Latitude])[1]).on("mouseover",w).on("mouseout",b).on("click",k)},t*100)}),t.text(l),s=!0})):$("#request-notice").fadeIn()})});